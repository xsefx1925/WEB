"use strict";(this.webpackChunk_msteams_react_web_client=this.webpackChunk_msteams_react_web_client||[]).push([[731276],{826657:(e,t,n)=>{var a;n.d(t,{k:()=>a,w:()=>s}),function(e){e.Configurations="Configurations",e.HorizontalBar="HorizontalBar",e.Main="Main",e.Modal="Modal",e.Monitor="Monitor",e.Rail="Rail",e.OverlayThinHorizontalBar="OverlayThinHorizontalBar",e.PartialOverlay="PartialOverlay",e.ThinHorizontalBar="ThinHorizontalBar",e.TitleBar="TitleBar",e.VerticalBar="VerticalBar",e.PreCache="PreCache"}(a||(a={}));const{ThinHorizontalBar:i,TitleBar:o,VerticalBar:r,...s}=a},529465:(e,t,n)=>{var a;n.d(t,{Y:()=>a}),function(e){e[e.chat=0]="chat",e[e.channel=1]="channel",e[e.tab=2]="tab",e[e.powerbar=3]="powerbar"}(a||(a={}))},912538:(e,t,n)=>{var a,i;n.d(t,{C:()=>a,Z:()=>i}),function(e){e.chats="chats",e.channels="channels"}(a||(a={})),function(e){e.ChatContextMenu="ChatContextMenu",e.CalendarEventContextMenu="CalendarEventContextMenu",e.ChannelContextMenu="ChannelContextMenu",e.OnedriveFileContextMenu="OnedriveFileContextMenu",e.SharepointFileContextMenu="SharepointFileContextMenu",e.MessageAction="MessageAction",e.MessageExtension="MessageExtension",e.PeopleCard="PeopleCard"}(i||(i={}))},94939:(e,t,n)=>{n.d(t,{Xp:()=>r,AX:()=>s,q0:()=>l,WD:()=>c,Tp:()=>d});var a=n(315560),i=n(999169),o=n(625270);function r(e,t){return{entity:{type:a.ck.chats,action:a.SY.create,id:s(e)},command:t}}function s(e){return JSON.stringify(e&&e.length>0?e.sort():[])}function l(e,t,n,a){let i={};if(!e)return i;if(e.type===t&&e.action===n){const t=e.options;if(t&&"string"==typeof t)try{i=JSON.parse(t)}catch{a.warn(`Entity options are in unexpected format. Expected a valid stringified JSON object but instead received: ${String(t)}.`)}}else a.warn(`Entity options are (incorrectly) being asked for type and action that do not pertain to the entity. ${String(e.type)} != ${String(t)} or ${String(e.action)} != ${String(n)}`);return i}const c=e=>`${e.substring(0,32)}00000000${e.substring(40)}`,d=(e,t,n,a,r)=>{let s=`${i.Hr}-${n}`;if(a){const t=e.getApp({entityType:a})?.manifest.id;s=t?`${i.Hr}-${t}-${a}`:s}const l=t.get((0,i.up)(s,r),"Experience"),c=l?(0,o.j)(l):null;return c?.mainEntity}},486856:(e,t,n)=>{n.d(t,{r:()=>i});var a=n(650656);const i={kind:"Document",get definitions(){const e=(0,a.G)("query messageToParentResult($appId:ID!) {messageToParentResult(appId:$appId) @client {appId,message}}");return delete this.definitions,this.definitions=e.definitions}}},424810:(e,t,n)=>{n.d(t,{hi:()=>l,n7:()=>s,ZN:()=>c,Hs:()=>d});var a=n(902537),i=n(650656);const o={kind:"Document",get definitions(){const e=(0,i.G)("query ServicesIoDataEspLockCurrentSurfaceIdQuery {currentEspSurfaceId @client}");return delete this.definitions,this.definitions=e.definitions}},r="growth_growthplatform_esp_common_component",s=async(e,t,n)=>{try{const a=e.readQuery({query:o});if(a&&a?.currentEspSurfaceId)return t.infoToTelemetry?.(`Couldn't show surface (${n}). ${a.currentEspSurfaceId} is showing`,r,void 0,!0),Promise.reject(!1);e.writeQuery({query:o,data:{currentEspSurfaceId:n}})}catch{return t.errorToTelemetry?.(`Couldn't show surface (${n}). Could not update current surface`,r,void 0,!0),Promise.reject(!1)}return Promise.resolve(!0)},l=async(e,t)=>{try{const n=e.readQuery({query:o});n&&n?.currentEspSurfaceId===t&&e.writeQuery({query:o,data:{currentEspSurfaceId:""}})}catch{return Promise.reject(!1)}return Promise.resolve(!0)},c=(e,t)=>{try{e.writeQuery({query:o,data:{currentEspSurfaceId:t}})}catch{throw new Error(`Couldn't change current surface to "${t}".`)}},d=()=>{const{data:e}=(0,a.I)(o);return e?.currentEspSurfaceId??""}},784463:(e,t,n)=>{n.d(t,{nv:()=>o,JT:()=>r,iO:()=>s});var a=n(401368),i=n(293980);const o=e=>e.get(a.w.Auth).buildCloud,r=(e,t)=>{const n=t?.get(a.w.Auth).cloudDomainMap;if(!n)return;const o=n.find((t=>t.domain===e))?.cloud;return o?i.el[o]:void 0},s=(e,t,n)=>{const i=t?.get(a.w.Auth).cloudDomainMap;if(!i||!e)return"";const o=i.find((t=>t.cloud===e))?.domain;return o?n?`https://${o}/`:`https://${o}/v2/`:""}},214546:(e,t,n)=>{n.d(t,{dz:()=>l,cd:()=>c,BD:()=>d,bo:()=>p,iy:()=>u,cF:()=>g,$f:()=>m,Cd:()=>h,sB:()=>f,t5:()=>I,iX:()=>y,lO:()=>w,k5:()=>v});var a=n(996234),i=n(859460),o=n(401368),r=n(36204),s=n(784463);const l=a.d,c=a.t.isLegacyMeetingUrl,d=a.t.isMeetingUrl,p=a.t.isTFLMeetingURL,u=a.t.getMeetingLegacyURL,g=(e,t)=>{const{enableIsTfwCloud:n}=t.get(o.w.Calling);return n?a.t.isTFWCloud((0,s.JT)(e,t)):a.t.isTFWDomain(e)},m=(e,t)=>{if(t){const n=(0,s.JT)(new URL(t).host,e);return!!n&&n!==(0,s.nv)(e)&&!f(t,e)}return!1},h=(e,t,n)=>{try{const i=(0,s.JT)(t,e),o=n?(0,s.JT)(n,e):(0,s.nv)(e),r=a.t.isInteropJoinAttemptBetweenTFLAndTFW(o,i);return!!i&&!!o&&i!==o&&!r}catch{return!1}},f=(e,t)=>{const{deepLinkDomain:n,enableMeetingBetweenTFWAndTFL:i,enableCrossCloudDetectionBasedOnLoggedInUserProps:r}=t.get(o.w.Calling);if(!r)return a.t.isDeepLinkExecutionForCrossCloudMeetingJoinBetweenTFLAndTFWAllowed(n||"",e,!!i);try{const o=new URL(e).hostname,r=(0,s.JT)(o,t),l=new URL(n||"").hostname,c=(0,s.JT)(l||"",t);return a.t.isMeetingUrl(e)&&a.t.isInteropJoinAttemptBetweenTFLAndTFW(c,r)&&!!i}catch(e){return!1}},I=e=>({coordinates:{meetingData:{instantMeetingOptions:void 0,isAdhoc:!0}},joinOptions:{outgoingVideo:!0,outgoingAudio:!0,context:"WatchParty",meeting:{deeplinkId:e,isWatchParty:!0,showPrejoin:!0}},type:"Meeting"}),y=(e,t,n,a,o,r,s,l,c,d,p,u)=>{let g;if((0,i.KX)(e)){const{conversationId:t,messageId:n,rootMessageId:a,isChannel:i,isAdhoc:o,tenantId:r,organizerId:s,meetingCloud:l,registration:c,participantPin:d,broadcast:p}=e;g={legacyMeeting:{conversationId:t,messageId:n,rootMessageId:a,isChannel:i,isAdhoc:o,tenantId:r,organizerId:s,meetingCloud:l,registration:c,broadcast:p,participantPin:d}}}else{const{meetingCode:t,passcode:n,meetingUrl:a}=e.meetingData,{isAdhoc:i,meetingCloud:o}=e;g={meetingData:{participantPin:e?.participantPin,meetingCode:t,passcode:n,meetingUrl:a,isAdhoc:i,meetingCloud:o}}}return{coordinates:g,joinOptions:{outgoingVideo:!1,outgoingAudio:!1,context:r||"DeepLink",meeting:{deeplinkId:t,showPrejoin:!0,isPSTN:!1,homeCloud:a,correlationId:o,launchAgent:s,laEntry:l,laExpId:c,isColdDeeplinkJoin:n,deeplinkEntityId:p,title:u}},scenarioCorrelationId:d,type:"Meeting"}},w=(e,t,n,a,i,o=!0,r)=>({coordinates:{legacyMeeting:{conversationId:n,messageId:a,rootMessageId:"",isChannel:!1,isAdhoc:!1,tenantId:e,organizerId:t,meetingCloud:"",broadcast:null,registration:i?{participantRegistrationId:i,isPublic:!0}:null,instantMeetingOptions:null}},joinOptions:{outgoingVideo:!1,outgoingAudio:!1,context:"Meeting EmbedLink",meeting:{showPrejoin:o,isPSTN:!1,skipGUM:!0},joinEventAsAttendee:r},type:"Meeting"}),v=e=>{e=e.replace("v2/?meetingjoin=true#/","").replace("v2/#/","");let t;if(d(e))try{const n=(0,r.wM)(e);t=n.isLegacyUrl?n.threadId:n.meetingId}catch{return}return t}},648527:(e,t,n)=>{function a(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-5][0-9a-f]{3}-[089ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}n.d(t,{a:()=>a})},793958:(e,t,n)=>{n.d(t,{j:()=>a});const a=(e,t)=>e?"Conversational":t?"PostReply":"Unthreaded"},999169:(e,t,n)=>{n.d(t,{Hr:()=>a,jE:()=>i,eW:()=>o,E:()=>r,up:()=>s});const a="appActiveEntitiesHistory",i="mainWindowNavHistory",o="mainWindowNavHistoryIndex",r=e=>{const t=["mainWindowNavHistory","mainWindowNavHistoryIndex"];return e&&t.push(`${e}-mainWindowNavHistory`,`${e}-mainWindowNavHistoryIndex`),t},s=(e,t)=>`${t?`${t}-`:""}${e}`},966313:(e,t,n)=>{n.d(t,{RB:()=>r,ip:()=>s,vN:()=>l,SR:()=>c,jK:()=>d,WG:()=>p,Vz:()=>u});var a=n(401368),i=n(622563),o=n(912127);function r(e){if(""===e)return null;const t=(0,o.Yn)("entity",i.l.Help,"training");return(0,o.jT)(e,t)}function s(e,t,n,a,i,r,s,l){const c=new URLSearchParams({source:n});return a&&c.append("sharedAppResource",a),i&&c.append("templateInstanceId",i),r&&c.append("environment",r),s&&c.append("titleId",s),l&&c.append("threadId",l),(0,o.jT)(e,`app/${t}`,c.toString())}function l(e,t,n,a,i,o,r){const s=new URLSearchParams;return!t||i||a||o||r||s.append("appId",t),r&&s.append("titleId",r),a&&s.append("templatedAppId",a),i&&s.append("templateInstanceId",i),o&&s.append("environment",o),n&&s.append("source",n),`${e}?${s.toString()}`}function c(e,t,n,a,i,o){return e&&t&&n?s(e,t,a,void 0,n,i,void 0,o):""}function d(e,t,n){return e&&t&&void 0!==n?(0,o.jT)(e,"marketplace",`deviceId=${t}&isTeamsRoomDevice=${n}`):""}function p(e,t){const{harmonyAppUrlRegex:n,enableHarmonyDeeplinkConversion:i}=t.get(a.w.Extensibility);return!(!n||!i)&&new RegExp(n).test(e)}function u(e,t,n){const{harmonyAppUrlRegex:i,enableHarmonyDeeplinkConversion:r,enableViralSharingLinkUnfurlingAndShortening:l}=n.get(a.w.Extensibility);if(!i||!r)return e;let c=e.replace(/&amp;/g,"&");const d=new RegExp(i),p=c.match(d);if(!p)return e;const u=new URLSearchParams(p[1]),g=u.get("templatedAppId")||"",m=u.get("templateInstanceId")||"",h=u.get("environment")||"",f=u.get("appId")||"",I=l&&u.get("titleId")||"",y=u.get("source")||(I?"biz-chat":"");return c=s((0,o.aE)(t),I?"":f||g,y,void 0,m,h,I),c}},679736:(e,t,n)=>{n.d(t,{u8:()=>c,qL:()=>d,VC:()=>h,ai:()=>f});var a=n(401368),i=n(396588),o=n(446154);const r=["msteams:","ms-teams:"],s=36,l=["/l/esp/whats-new-content","/l/esp/teams-insider"];function c(e,t,n=!1){const{deepLinkDomains:i,deepLinkPaths:o,supportHashDeeplinks:r}=t.get(a.w.Messaging),s=n?[""]:o||[];let l=i||[];return n||(l=l.concat(function(e){const{enableCrossCloudLaunch:t}=e.get(a.w.Core);if(!t)return[];const n=e?.get(a.w.Auth).cloudDomainMap;if(!n)return[];const i=n.map((e=>`https://${e.domain}`));return i}(t))),m({url:e,deepLinkDomains:l,deepLinkPaths:s,supportHashDeeplinks:!!r,coreSettings:t})}function d(e,t){if(r.includes(e.protocol)){const n=t.get(a.w.Host).deepLinkDomain||void 0,i=p(e,t)||n;return new URL(`${e.pathname}${e.search}${e.hash}`,i)}return e}const p=(e,t)=>{const{enableOriginValidationForIncomingIntents:n}=t.get(a.w.Core);if(!n||"null"!==e.origin)return e.origin;if(!r.includes(e.protocol))return;const i=e.searchParams.get("fqdn");return i?new URL(`https://${i}`).origin:"null"===e.origin&&e.hostname?new URL(`https://${e.hostname}`).origin:void 0},u=(e,t,n,a)=>{const i=p(e,a);return!(i&&i!==t.origin||!e.pathname.startsWith(n))},g=(e,t,n)=>{const a=p(e,n);return!(a&&a!==t.origin||!e.hash||"/_"!==e.pathname)},m=({url:e,deepLinkDomains:t,deepLinkPaths:n,supportHashDeeplinks:a,coreSettings:i})=>{for(const o of t)for(const t of n){let n,r;try{n=new URL(e),r=new URL(t,o)}catch(e){return!1}if(u(n,r,t,i))return!0;if(a&&g(n,r,i))return!0}return!1};function h(e){return e?.slice(0,s)??null}function f(e,t){e.scenarioName===i.Cu.ActivitySwitch&&e.source===o.p.ActivityFeedBellClick&&l.includes(t)&&(e.scenarioName=i.Cu.NavigationCommand)}},322933:(e,t,n)=>{n.d(t,{q:()=>a});const a=(e,t,n)=>{if(e&&t){const t=/^(.*); expires=(.*); path=\/(; (.*))?$/,a=2,i=e.match(t);if(i){const e=new Date(i[a]).getTime()>Date.now();return n?.log(`ATPSafelinks: isValidAtpPolicy returning cookieNotExpired=${e}`),e}n?.warn("ATPSafelinks: isValidAtpPolicy returning false as the cookie does not match the cookie regex")}else n?.warn(`ATPSafelinks: isValidAtpPolicy returning false as a param is falsy, param to blame: cookie=${!e}, webAffinitizedUrl=${!t}`);return!1}},49761:(e,t,n)=>{n.d(t,{W:()=>r});var a=n(461167);const i=new RegExp(a.vg.oneDriveFile),o=new RegExp(a.vg.sharePointFile),r=(e,t)=>{if(t){const n=t.replace(a.vg.leadingAndTrailingSlashesRegex,"").split("/");n.pop();const i=n.join("/");return`${new URL(e).origin}/${i}/`}if(o.test(e)){const t=e.match(o);return t?t[0]:null}if(i.test(e)){const t=e.match(i);return t?t[0]:null}if(e){const t=e.split("/"),n=2;if(t.length>=n)return`${t[0]}//${t[n]}/`}return e}},920246:(e,t,n)=>{var a;n.d(t,{b:()=>a}),function(e){e.logErrorMessage="logErrorMessage",e.internalErrorCode="internalErrorCode",e.spoInnerErrorCode="spoInnerErrorCode",e.correlationId="correlationId",e.httpCode="httpCode",e.errorCode="errorCode",e.isExpected="isExpected",e.isRedirect="isRedirect",e.redirectUrl="redirectUrl",e.reason="reason",e.serverResponse="serverResponse"}(a||(a={}))},191980:(e,t,n)=>{n.d(t,{m:()=>i});var a=n(461167);const i=e=>{switch(e){case a.jL.unauthorizedAccess:return!1;case a.jL.clientError:case a.jL.badRequest:case a.jL.internalServerError:case a.jL.serviceUnavailable:case a.jL.tooManyRequests:return!0;default:return!1}}},899631:(e,t,n)=>{n.d(t,{q6:()=>c,O3:()=>d,ei:()=>p,tn:()=>I,qE:()=>y,lW:()=>w});var a=n(879749),i=n(214568),o=n(401368),r=n(418709),s=n(424810);const l="growth_growthplatform_esp_common_component",c=()=>{const{entityCommanding:e}=(0,a.ur)(),t=(0,r.m)();return n=>((0,s.ZN)(t,n),e.esp.launchDialog(n))};function d(e,t,n,a){return e&&t?`${n(a,e,void 0,!0)} ${n(a,t,void 0,!0)}`:n(a,e||t,void 0,!0)}function p(e,t,n,a){const i=w(t,a).reduce(((e,t)=>(e[t.id]=t,e)),{})[e];if(i)if(i?.id||(i.id=e),"Coachmark"!==i.surface||function(e,t){if(e.__typename&&"EspCoachmarkParams"!==e.__typename)return!1;const n=e,a=(e,n)=>h(e,n,t),{targetId:i,content:o,header:r,position:s,align:l,pointing:c,sticky:d,primaryButton:p,secondaryButton:g,selector:m}=n;return(f(i)||f(m)||a(void 0,"target"))&&a(o,"content")&&(!r||"localized"===r.type&&a(r.localizedContent,"header.localizedContent")||a(r.key,"header.key")&&a(r.namespace,"header.namespace"))&&a(s,"position")&&a(l,"align")&&a(c,"pointing")&&a(d,"sticky")&&u(p,"primaryButton",t)&&u(g,"secondaryButton",t)}(i.params,n))if("Modal"!==i.surface||function(e,t){if(e.__typename&&"EspModalParams"!==e.__typename)return!1;const n=e,a=(e,n)=>h(e,n,t),{userInterfaceControls:i}=n;return a(i,"userInterfaceControls")&&function(e,t){const n=e&&e.map((e=>{switch(e.type){case"image":return m(e,t);case"video":return function(e,t){return e&&h(e.title,"title",t)&&h(e.src,"src",t)}(e,t);case"button":return function(e,t){return e&&h(e.isPrimary,"isPrimary",t)&&h(e.action,"action",t)}(e,t);case"text":return g(e,t);case"space":return function(e,t){return e&&h(e.height,"height",t)}(e,t);case"infoItem":return function(e,t){return m(e.image,t)&&g(e.title,t)&&g(e.description,t)}(e,t);case"themePicker":case"simpleCollabViewPicker":case"copilotEverywhere":return!0;case"accountPicker":return function(e,t){return e&&h(e.filterAccountType,"filterAccountType",t)}(e,t);case"freePremiumExperience":return function(e,t){return e&&h(e.options,"options",t)}(e,t);default:return!1}}));return!(!n||n.indexOf(!1)>-1)}(i,t)}(i.params,n)){if("QuickGuide"!==i.surface||function(e,t,n){if(e.__typename&&"EspQuickGuideParams"!==e.__typename)return!1;const a=e,i=a.cards,o=(e,t)=>h(e,t,n),{cards:r}=a;if(!o(r,"cards"))return!1;if(0===r.length)return n.errorToTelemetry?.(`Cards for surface: ${t} are not defined.`,l,void 0,!0),!1;return i.every((({targetId:e,selector:t,content:n,header:a,position:i,align:r,pointing:s})=>(f(e)||f(t)||o(void 0,"target"))&&o(n,"content")&&(!a||"localized"===a.type&&o(a.localizedContent,"header.localizedContent")||o(a.key,"header.key")&&o(a.namespace,"header.namespace"))&&o(i,"position")&&o(r,"align")&&o(s,"pointing")))}(i.params,e,n))return i;n.errorToTelemetry?.(`QuickGuide surface: ${e} is incorrectly defined.`,l,void 0,!0)}else n.errorToTelemetry?.(`Dialog surface: ${e} is incorrectly defined.`,l,void 0,!0);else n.errorToTelemetry?.(`Coachmark surface: ${e} is incorrectly defined.`,l,void 0,!0);else n.errorToTelemetry?.(`Cannot find surface: ${e} in ESP configuration.`,l,void 0,!0)}function u(e,t,n){return!e||h(e.content,`${t}.content`,n)&&h(e.action,`${t}.action`,n)}function g(e,t){return e&&h(e.resource,"resource",t)}function m(e,t){return e&&h(e.alt,"alt",t)&&h(e.src,"src",t)}function h(e,t,n){return void 0===e&&n.errorToTelemetry?.(`Required property ${t} is not defined.`,l,void 0,!0),void 0!==e}function f(e){return void 0!==e}function I(e){return"Coachmark"===e||"QuickGuide"===e}const y=e=>{switch(e){case"Modal":return i.rP.dialog;case"Coachmark":default:return i.rP.popover;case"QuickGuide":return i.rP.quickGuide;case"SyntheticNotification":case"TfwNotification":return i.rP.activityFeed}},w=(e,t)=>{const n=v(e);return t&&t.length?n.concat(t):n},v=e=>{const t=e.get(o.w.Esp),{testAutomation:n}=e.get(o.w.Test),a=[];return Object.keys(t).forEach((e=>{const i=t[e];i&&i.surface&&!!n==!!i.isTest&&a.push(S(i,e))})),a},S=(e,t)=>({...e,id:t,priority:e.priority,trigger:e.trigger,surface:e.surface,recur:Math.max(-1,e.recur||1),isControlGroup:!!e.isControlGroup,triggerFilter:e.triggerFilter,targetWindow:e.targetWindow,condition:e.condition,fetchDataKeys:e.fetchDataKeys||[],dataCondition:e.dataCondition,expiryDate:e.expiryDate,viewExternalTelemetry:e.viewExternalTelemetry,closeExternalTelemetry:e.closeExternalTelemetry,dataIdentifier:e.dataIdentifier,categories:e.categories,delayInSeconds:Math.max(Number.isInteger(e.delayInSeconds)?e.delayInSeconds:0,0),ignoreLock:!!e.ignoreLock,params:e.params})},708645:(e,t,n)=>{n.d(t,{q:()=>i});var a=n(650656);const i={kind:"Document",get definitions(){const e=(0,a.G)("query ComponentsFileActionsChannelQuery($conversationId:ID!) {channelByID(conversationId:$conversationId) {channelType,displayName,description,defaultFileSettings {filesRelativePath},id,owningTeam {id,displayName,teamSiteInformation {groupId},isArchived,teamType,tenantId},memberRole}}");return delete this.definitions,this.definitions=e.definitions}}},605733:(e,t,n)=>{n.d(t,{x:()=>o});var a=n(650656);const i={kind:"Document",get definitions(){const e=(0,a.G)("query ComponentsStageViewUtilsAppDefinitionQuery($appId:ID!,$scope:AppInstallScope,$conversationId:String,$options:AppsFilterOptionsInput) {appDefinition(appId:$appId,scope:$scope,conversationId:$conversationId,options:$options) {id,bots {id,scopes},connectors {scopes},messageExtensions {scopes,commands {id,appKey,context}},meetingExtensionDefinition {scenes {id},filters {id}},galleryTabs {scopes},staticTabs {scopes},tenantId,isMicrosoftOwned,isFullScreenApp,isBlocked}}");return delete this.definitions,this.definitions=e.definitions}},o=async(e,t,n,a,o,r,s)=>{let l;if(n&&(l=a||"GroupChat"),s)return;const{data:c,error:d}=await e.query({query:i,variables:{appId:t,scope:l,conversationId:n,options:{allowBlockedApps:r}},context:{callerInfo:`${o}-getAppDefinition`}});return c&&c.appDefinition&&!d?c.appDefinition:void 0}},982396:(e,t,n)=>{n.d(t,{H:()=>r});var a=n(396588),i=n(147994),o=n(605733);const r=async(e,t,n,r,s)=>{try{const{appId:l}=e,c=await(0,o.x)(t,l,e.convId,e.appInstallScope,"launch-mw-stage-view-without-chat");e.isFullScreenApp=!!c&&(0,i.QP)(c),r?.appendEventData({"App.isFullScreenApp":e.isFullScreenApp,"StageView.OpenMode":"popout","StageView.CorrelationId":e.correlationId}),r?.mark(a.BQ.StageViewAppDefFetchedBeforeLaunch);const d=(0,i.Gi)(e,e.contentUrl);return d?(r?.mark(a.BQ.LaunchingCollabStageWithoutChatEntityCommand),n.platform.launchStageMWWithoutChat({id:d,stageOptions:e,commandSource:s})):Promise.reject("Entity commanding not available")}catch(e){throw r?.mark(a.BQ.StageViewFailedBeforeCommandTrigger),e}}},441308:(e,t,n)=>{n.d(t,{p:()=>o});var a=n(396588),i=n(147994);const o=async(e,t,n,o)=>{n?.appendEventData({"StageView.OpenMode":"popoutWithChat","StageView.CorrelationId":e.correlationId});const{stageViewId:r,linkedEntity:s}=(0,i.iE)(e);return r&&s?(n?.mark(a.BQ.LaunchingCollabStageWithChatEntityCommand),t.platform.launchStageMW({id:r,linkedEntity:s,stageOptions:e,commandSource:o})):Promise.reject("Entity commanding not available")}},228986:(e,t,n)=>{n.d(t,{N:()=>V});var a=n(282076),i=n(438e3),o=n(214568),r=n(401368),s=n(446154),l=n(315560),c=n(413500),d=n(396588),p=n(725609),u=n(147994),g=n(431687),m=n(189189),h=n(75190);var f=n(650656);const I={kind:"Document",get definitions(){const e=(0,f.G)("fragment ComponentsStageViewUtilsAppDefinitionFragment on AppDefinition {id,name,developerName,developerUrl,privacyUrl,termsOfUseUrl,version,shortDescription,longDescription,smallImageUrl,largeImageUrl,accentColor,categories,validDomains,externalId,tenantId,isBlocked,isFullScreenApp,isFullTrustApp,isMicrosoftOwned,showTabLoadingIndicator,videoUrl,devicePermissions,defaultInstallScope,manifestVersion,disabledScopes,galleryTabs {configurationUrl,canUpdateConfiguration,canHaveTabConversation,scopes,meetingSurfaces,context},staticTabs {entityId,name,order,contentUrl,contentBotId,websiteUrl,scopes,context,containerAppIds},webApplicationInfo {id,appKey,resource,applicationPermissions}}");return delete this.definitions,this.definitions=e.definitions}},y={kind:"Document",get definitions(){const e=(0,f.G)("fragment ComponentsStageViewUtilsInstalledAppFragment on InstalledApp {id,installationState,installedVersion,installedScope,definition {id,...ComponentsStageViewUtilsAppDefinitionFragment}}");return delete this.definitions,this.definitions=[...e.definitions,...I.definitions]}},w={kind:"Document",get definitions(){const e=(0,f.G)("query ComponentsStageViewUtilsInstalledSideLoadAppQuery($installedScope:AppInstallScope!,$externalId:String!,$conversationId:String) {installedSideLoadApp(installedScope:$installedScope,externalId:$externalId,conversationId:$conversationId) {id,...ComponentsStageViewUtilsInstalledAppFragment}}");return delete this.definitions,this.definitions=[...e.definitions,...y.definitions]}},v={kind:"Document",get definitions(){const e=(0,f.G)("query ComponentsStageViewUtilsInstalledAppByIdQuery($installedScope:AppInstallScope!,$appId:ID!,$conversationId:String) {installedApp(installedScope:$installedScope,appId:$appId,conversationId:$conversationId) {id,installedScope,installationState}}");return delete this.definitions,this.definitions=e.definitions}};var S=n(605733);const C=async(e,t,n,a,i,o)=>{const{appId:r,convId:s,replyChainId:l,channelId:c}=e,p=c||l?void 0:s,u=l?c||s:c,m=u||p||"";let h="Personal";try{h=await A(t,p,u),e.appInstallScope=h,P(d.BQ.StageViewTargetInstallationScopeConfirmed,`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${u} is ${h}`,i,o),a.log(`confirmed installed scope for chatThreadId: ${p}, channelThreadId: ${u} is ${h}`);const s={conversation:{id:m,scope:h},shouldFetchPersonalApps:!0},l=await(async(e,t,n,a,i)=>{const o=i||{},r=t.newScenario(d.Cu.ExtInstalledAppsV2);try{const t=[];if(r.appendEventData({dataSource:"installedApp query",correlationId:a}),o.shouldFetchPersonalApps){const i=e.query({query:v,variables:{installedScope:"Personal",appId:n},context:{callerInfo:`${a}-getInstalledAppById`}}).then((e=>e.data?.installedApp));t.push(i)}if(o.conversation&&o.conversation.id){const i=e.query({query:v,variables:{installedScope:o.conversation.scope,appId:n,conversationId:o.conversation.id},context:{callerInfo:`${a}-getInstalledAppsById`}}).then((e=>e.data?.installedApp));t.push(i)}const i=(await Promise.all(t)).filter((e=>!!e));return r.mark(d.BQ.ExtAppsProcessed),r.stop({appCount:i.length}),i}catch(e){return r.fail({errors:`failed to get installed app id: ${n}`}),[]}})(t,n,r,`jit-install-for-stage-view-${e.entryPoint}`,s);a.log(`Fetched Installed apps length: ${l.length} `);const c=l.find((e=>(0,g.e6)(e)));if(P(d.BQ.StageViewInstalledAppsFetched,`${l?.length} appEntitlements returned with preInstalledApp as ${!!c}, for ${h} scope and ${m} threadId.`,i,o),c)return i?.mark(d.BQ.StageViewAppIsPreInstalled),o?.mark(d.BQ.StageViewAppIsPreInstalled),{appInstalled:!0,appInstallScope:c.installedScope};{const s=await $(t,a,r,h,m,!l.length,i,o);if(s?.definition)return e.appId=s.definition.id||e.appId,e.appInstallScope=h,i?.appendEventData({"App.isSideLoaded":!!s.definition.externalId}),o?.appendEventData({"App.isSideLoaded":!!s.definition.externalId}),P(d.BQ.StageViewAppIsPreInstalled,`App ${s.definition.externalId} is sideloaded, with internalAppId ${s.definition.id}`,i,o),{appInstalled:!0,appInstallScope:h};P(d.BQ.StageViewAppIsNotPreInstalled,`${l?.length} appEntitlements returned for ${h} scope and ${m} threadId.`,i,o);const{appInstalled:c,appInstallScope:p}=await b(r,m,h,t,n,a,i,o);return e.appInstallScope=p,{appInstalled:c,appInstallScope:p}}}catch(e){return k(a,h,i,o,e?.message,m),{appInstalled:!1,appInstallScope:h}}},A=async(e,t,n)=>{if(n)return"Team";if(t){const n=await(async(e,t,n)=>{const{data:a}=await t.query({query:h.A,variables:{convId:e},context:{callerInfo:n}});return a.chat?.isOneOnOneBotChat??!1})(t,e,"handleJITInstallForStageView");return n?"Personal":"GroupChat"}return"Personal"},b=async(e,t,n,a,i,o,r,s)=>{let l=!1,c=n;const p=await(0,S.x)(a,e,t,n,"jit-install-for-stage-view",!0);if(!p)return T(o,`App ${e} could'nt be fetched from app catalog. App might not exist in the store.`,r,s),{appInstalled:l,appInstallScope:c};if(P(d.BQ.StageViewAppDefFetched,`App.isBlocked: ${p?.isBlocked||!1}`,r,s),p.isBlocked)return T(o,`App ${e} is blocked by tenant, can not show the app content`,r,s),{appInstalled:l,appInstallScope:c};const u=(0,m.Z1)("Personal",p);let g;if(u){c="Personal";const t=`installing in personal scope: isPersonalScopeSupported: ${u}`;P(d.BQ.StageViewInstallingInPersonalScope,t,r,s),g=await(0,m.Pe)(a,i,d.Cu.AppInstallationDialogInstallApp,e,"Personal",o,!0,void 0,{reason:t,"App.Scope":"Personal",correlationId:s?.id},void 0,"jit-install-for-stage-view"),l=!!g}else if("Personal"!==n&&(0,m.Z1)(n,p)){const p=`installing in scope: ${n}, conversationId: ${t}`;P(d.BQ.StageViewInstallingInChatChannelScope,p,r,s);try{g=await(0,m.Pe)(a,i,d.Cu.AppInstallationDialogInstallApp,e,n,o,!0,t,{reason:p,correlationId:s?.id,"App.Scope":n},void 0,"jit-install-for-stage-view")}catch(e){k(o,n,r,s,e?.message,t)}l=!!g,c=n}else T(o,`installScope: ${n} is not supported by app: ${e}`,r,s);return l&&P(d.BQ.StageViewAppInstallationDone,`installed in ${c} scope, conversationId: ${t}`,r,s),{appInstalled:l,appInstallScope:c}},P=(e,t,n,a)=>{n?.mark(e,{reason:t}),a?.mark(e,{reason:t})},T=(e,t,n,a)=>{e.warn(t),n?.incomplete({reason:t}),a?.incomplete({reason:t})},k=(e,t,n,a,i,o)=>{const r=`JIT-Install failed in scope: ${t}, conversationId: ${o} Reason: ${i}`;e.error(r),i?.includes("NoPermissionToInstallApp")?T(e,"User does not have permissions to install app in scope",n,a):(n?.fail({errors:r}),a?.fail({errors:r}))},$=async(e,t,n,a,i,o,r,s)=>{const l={installedScope:a,externalId:n,conversationId:i};try{if(o){const{data:t}=await e.query({query:w,variables:l,fetchPolicy:"cache-first",context:{callerInfo:"jit-install-for-stage-view"}});return P(d.BQ.StageViewSideLoadQueryReturned,`Side load query returned for app ${n}`,r,s),t?.installedSideLoadApp}return null}catch(e){return t.error(`Failed fetching side loading details for app ${n}, threadId: ${i}, scope, ${a}: ${e}`),null}};var E=n(441308);const M=(e,t,n,a,i)=>{const{enableReactStageModal:o}=t.get(r.w.Extensibility);return o?(i?.appendEventData({"StageView.OpenMode":"modal","StageView.CorrelationId":e.correlationId}),i?.mark(d.BQ.LaunchingStageModalEntityCommand),n.platform.launchReactStageModal(e.appId,e,{visibilityState:c.Rp.show,stateTransition:c.Ar.extend,correlation:{source:a,id:e.correlationId}}).toPromise()):n.platform.launchStage({stageOptions:e,entityCommand:{stateTransition:c.Ar.extend,visibilityState:c.Rp.show,correlation:{source:a}}}).toPromise()};var D=n(982396),F=n(405826);const B=e=>{let t=i.bY.personal;switch(e){case"Team":t=i.bY.team;case"GroupChat":t=i.bY.group}return t},V=async(e,t,n,a,s,l,c,p,g)=>{const{enableCommandingTelemetryForCollabStageMW:m,enableReactStageModal:h,enableProgrammaticPopoutStageViewOpenAPI:f,enableProgrammaticPopoutStageDeeplink:I}=t.get(r.w.Extensibility);let y,w,v=e;if(!m){const{phase1CollabStageScenario:e,endToEndScenario:t}=(0,u.d1)(a);y=e,w=t,v.launchScenarioId=t.id,v.phase1OnlyScenarioDetails={scenarioMarkerName:e.name,scenarioMarkerId:e.id}}if(!v.appId)return y?.incomplete({errors:"AppId cannot be empty for launching stage view"}),w?.incomplete({errors:"AppId cannot be empty for launching stage view"}),Promise.reject("AppId cannot be empty for launching stage view");if(l)try{v=await x(s,l,v,n,y,w)}catch(e){return Promise.reject(`Could not determine if threadId passed is chat/channel: ${e}`)}if(v.openMode=(0,u.mg)(t,v),y?.appendEventData({"App.Id":v.appId,"Thread.Id":v.convId,"PlatformApp.ScenarioCapability":i.n3.tabs,"App.EntryPoint":v.entryPoint,"StageView.OpenMode":v.openMode,"StageView.inputThreadIdDefined":!!l,"StageView.CorrelationId":v.correlationId,"PlatformApp.IsMultiWindow":v.openMode!==u.bq.modal}),w?.appendEventData({"App.Id":v.appId,"Thread.Id":v.convId,"App.EntryPoint":v.entryPoint,"StageView.OpenMode":v.openMode,"StageView.inputThreadIdDefined":!!l,"StageView.CorrelationId":v.correlationId,"PlatformApp.IsMultiWindow":v.openMode!==u.bq.modal}),!h&&v.openMode===u.bq.modal&&c)return y?.cancel({errors:"Opening angular modal hence cancelling react scenarios"}),w?.cancel({errors:"Opening angular modal hence cancelling react scenarios"}),O(v,t,n,c,void 0);const{appInstalled:A,appInstallScope:b}=await C(v,n,a,s,y,w);if(p&&p.recordPanelAction(((e,t,n,a,r)=>{const{actionOutcome:s,panelType:l}=(0,u.lT)(n,a),c=r.createDatabag(),d={actionGesture:o.Od.auto,actionOutcome:s,actionScenario:o.vB.openStageView,actionScenarioType:o.DB.stageView,moduleName:o.Sn.stageViewMainContent,moduleType:o.nR.stageview,panelRegion:n===u.bq.modal?o.rP.dialog:o.rP.main,panelType:l,extensibilityData:{id:e,scope:t,scenarioCapability:i.n3.tabs}};return d.dataBag=c,d})(v.appId,B(b),v.openMode,v.entryPoint,p)),g){const e=g.createDatabag(),{actionOutcome:t,panelType:n}=(0,u.lT)(v.openMode,v.entryPoint),a={actionGesture:o.Od.auto,actionOutcome:t,actionScenario:o.vB.openStageView,actionScenarioType:o.DB.stageView,moduleName:o.Sn.stageViewMainContent,moduleType:o.nR.stageview,panelRegion:v.openMode===u.bq.modal?o.rP.dialog:o.rP.main,panelType:n,dataBag:e,extensibilityData:{id:v.appId,scope:B(b),scenarioCapability:i.n3.tabs}};g.recordPanelAction(a,s)}if(A){y?.appendEventData({"App.Scope":b}),w?.appendEventData({"App.Scope":b});const e=await(0,S.x)(n,v.appId,v.convId,b,"launch-stage-view",!0,v.openMode===u.bq.modal);return y?.mark(d.BQ.StageViewAppDefFetchedBeforeLaunch),w?.mark(d.BQ.StageViewAppDefFetchedBeforeLaunch),v.isFullScreenApp=!!e&&(0,u.QP)(e),O(v,t,n,c,y,w,!!f,!!I).catch((()=>(w?.fail({errors:"Failed to launch"}),y?.fail({errors:"Failed to launch"}),_())))}return y?.fail({errors:`App could not be installed- ${b}`}),w?.fail({errors:`App could not be installed- ${b}`}),_()},x=async(e,t,n,i,o,r)=>{let s={chat:null};try{s=await(0,a.zB)(i,t)}catch(n){o?.mark(d.BQ.ChatQueryFailed,{reason:`ChatQuery failed for inputThreadId: ${t}`}),r?.mark(d.BQ.ChatQueryFailed,{reason:`ChatQuery failed for inputThreadId: ${t}`}),e.error(`Could not determine if inputThreadId is chat/channel, ChatQuery failed for inputThreadId: ${t}`)}if(s?.chat){const{chatSubType:a,memberIds:i}=s.chat;switch(o?.mark(d.BQ.ChatQuerySuccessful,{reason:`chatSubType: ${a}, memberIds.length: ${i?.length}`}),r?.mark(d.BQ.ChatQuerySuccessful,{reason:`chatSubType: ${a}, memberIds.length: ${i?.length}`}),a){case F.vW.Channel:return e.log(`inputThreadId is a channel ${t}`),{...n,convId:t,channelId:t,replyChainId:void 0,messageId:void 0};case F.vW.Meeting:case F.vW.None:e.log(`inputThreadId is a chat ${t}`);const a={...n,convId:t,channelId:void 0,replyChainId:void 0,messageId:void 0};return i&&0!==i.length||n.openMode===u.bq.modal?a:{...a,openMode:u.bq.popout};default:return e.error("chatSubType is not present in chatQuery return, launching stage view in personal scope context"),{...n,convId:"",channelId:void 0,replyChainId:void 0,messageId:void 0}}}return o?.mark(d.BQ.ChatQueryReturnedEmptyData,{reason:`ChatQuery result is empty for inputThreadId: ${t}`}),r?.mark(d.BQ.ChatQueryReturnedEmptyData,{reason:`ChatQuery result is empty for inputThreadId: ${t}`}),e.error(`Could not determine if inputThreadId is chat/channel, ChatQuery result is empty for inputThreadId: ${t}`),{...n,convId:"",channelId:void 0,replyChainId:void 0,messageId:void 0}},O=async(e,t,n,a,i,o,r,s)=>{try{const l=j(e.entryPoint);switch(e.entryPoint){case p.hB.adaptiveCardCollabStage:return await U(e,l,a,i);case p.hB.fileChiclet:return await L(e,n,l,a,i);case p.hB.deepLinkStageView:return await Q(e,i,o,s);case p.hB.stageViewOpenSDKApi:return await R(e,t,n,l,a,i,r);case p.hB.adaptiveCardStageModal:return await W(e,t,l,a,i);default:return Promise.reject(`Stage view entry point not supported. Entrypoint: ${e.entryPoint}`)}}catch(e){return q(e,i,o),Promise.reject(e)}},U=async(e,t,n,a)=>n?(0,E.p)(e,n,a,t):Promise.reject("Entity commanding not available"),L=async(e,t,n,a,i)=>a?e.openMode===u.bq.popout?(0,D.H)(e,t,a,i,n):(0,E.p)(e,a,i,n):Promise.reject("Entity commanding not available"),Q=async(e,t,n,a)=>{if(!e.contentUrl)return t?.incomplete({errors:"ContentUrl cannot be empty for deeplink"}),n?.incomplete({errors:"ContentUrl cannot be empty for deeplink"}),_();if(!a)return z(e,t);switch(e.openMode){case u.bq.modal:return z(e,t);case u.bq.popoutWithChat:return e={...e,showChatTitleForHeader:!0},H(e,t);case u.bq.popout:return N(e,t);default:return z(e,t)}},R=async(e,t,n,a,i,o,r)=>{if(!r)return i?M({...e,openMode:"modal"},t,i,a,o):Promise.reject("Entity commanding not available");switch(e.openMode){case u.bq.popout:return i?(0,D.H)(e,n,i,o,a):Promise.reject("Entity commanding not available");case u.bq.popoutWithChat:return i?(0,E.p)(e,i,o,a):Promise.reject("Entity commanding not available");case u.bq.modal:default:return i?M(e,t,i,a,o):Promise.reject("Entity commanding not available")}},W=async(e,t,n,a,i)=>a?M(e,t,a,n,i):Promise.reject("Entity commanding not available"),q=(e,t,n)=>{const a=e instanceof Error?e.message:String(e);t?.fail({errors:`Unexpected error occurred-${a}`}),n?.fail({errors:`Unexpected error occurred-${a}`})},j=e=>{switch(e){case p.hB.stageViewOpenSDKApi:return s.p.StageViewOpenSDKApi;case p.hB.deepLinkStageView:return s.p.StageViewDeeplink;case p.hB.fileChiclet:return s.p.FileChicletActions;default:return s.p.AdaptiveCardInvokeButton}},H=async(e,t)=>{const{stageViewId:n,linkedEntity:a}=(0,u.iE)(e);return n&&a?(t?.mark(d.BQ.LaunchingCollabStageWithChatEntityCommand),Promise.resolve({entityCommand:{entity:{id:n,type:l.ck.platformStage,action:l.SY.create,linkedEntity:a},command:{stateTransition:c.Ar.new,visibilityState:c.Rp.show,correlation:{id:e.correlationId,source:s.p.StageViewDeeplink,startTimestamp:e.scenarioStartTime}},entityOptions:e},metadata:{allowAnonymous:!1}})):Promise.reject("Entity commanding not available")},_=async()=>Promise.resolve({entityCommand:{entity:{type:l.ck.unsupportedcollabstageerrordialog,action:l.SY.view},command:{stateTransition:c.Ar.extend,visibilityState:c.Rp.show},entityOptions:{}},metadata:{allowAnonymous:!1}}),N=async(e,t)=>{const n=(0,u.Gi)(e,e.contentUrl);return n?(t?.mark(d.BQ.LaunchingCollabStageWithoutChatEntityCommand),Promise.resolve({entityCommand:{entity:{id:n,type:l.ck.platformstagewithoutchat,action:l.SY.view},command:{stateTransition:c.Ar.new,visibilityState:c.Rp.show,correlation:{id:e.correlationId,source:s.p.StageViewDeeplink,startTimestamp:e.scenarioStartTime}},entityOptions:e},metadata:{allowAnonymous:!1}})):Promise.reject("Entity commanding not available")},z=async(e,t)=>{const n={entityCommand:{entity:{id:e.appId,type:l.ck.platformstagemodal,action:l.SY.view},command:{visibilityState:c.Rp.show,stateTransition:c.Ar.extend,correlation:{id:e.correlationId,source:s.p.StageViewDeeplink}},entityOptions:e},metadata:{allowAnonymous:!1}};return t?.mark(d.BQ.LaunchingStageModalEntityCommand),Promise.resolve(n)}},541169:(e,t,n)=>{n.d(t,{Ze:()=>a,I_:()=>B,h5:()=>x});var a,i=n(513432),o=n(879749),r=n(246601),s=n(401368),l=n(596164),c=n(315560),d=n(798238),p=n(418709),u=n(189189),g=n(604279),m=n(272924),h=n(79743),f=n(544825),I=n(323040),y=n(182504),w=n(169195),v=n(924162),S=n(196131),C=n(753318),A=n(564083),b=n(288325),P=n(764076),T=n(396588),k=n(708645),$=n(461167),E=n(160035),M=n(228986),D=n(725609),F=n(44714);!function(e){e.PlatformApp="PlatformApp",e.OneUp="OneUp",e.OneUpPageEmbed="OneUpPageEmbed"}(a||(a={}));const B=()=>{const{entityCommanding:e,scenarioFactory:t,windowHistoryNavigationService:n,coreSettings:a}=(0,o.ur)(),{entity:c,getEntityOptions:u}=(0,r.At)(),g=(0,p.m)(),{enableAppBasedFileHandlingForWXPTMP:m,enableFilesAppBasedFileHandlingForPDFTMP:h,enableFilesPDFAppIdForViewTMP:f,enableFilesAdminPreinstallCheckForPDFAppTMP:I,enableFilesAAACheckForPDFAppTMP:y,allowedInstallerAzureADAppIdsForPDFApp:w,enableAppBasedFileHandlingForOneNoteTMP:v,enableAppBasedFileHandlingForVisioTMP:S}=(0,d.w2)(s.w.Files,["enableAppBasedFileHandlingForWXPTMP","enableFilesAppBasedFileHandlingForPDFTMP","enableFilesPDFAppIdForViewTMP","enableFilesAdminPreinstallCheckForPDFAppTMP","enableFilesAAACheckForPDFAppTMP","allowedInstallerAzureADAppIdsForPDFApp","enableAppBasedFileHandlingForOneNoteTMP","enableAppBasedFileHandlingForVisioTMP"]),{enableCollabStageForWXP:C}=(0,d.w2)(s.w.Extensibility,["enableCollabStageForWXP"]),{enableAppsQueryOptimization:A,enablePopOutFileChicletInMultiWindow:b,enableInstalledAppQueryOptimization:P}=(0,d.w2)(s.w.Extensibility,["enableAppsQueryOptimization","enablePopOutFileChicletInMultiWindow","enableInstalledAppQueryOptimization"]),{isPrimaryWindow:T}=(0,d.w2)(s.w.Core,["isPrimaryWindow"]),k=(0,l.U)("InTeamsFileViewerResolver"),$=i.useRef(new Map),{sdkHostType:E}=(0,d.w2)(s.w.Sdk,["sdkHostType"]);return i.useCallback((async(i,o,r,s)=>{V(R(i,!!b,!!T),o,r,s,e,a,c,n,u,g,!!m,!!h,!!y,f,w,!!I,!!v,!!S,!!A,!!P,!!C,E,k,t,$)}),[b,T,e,a,c,n,u,g,m,h,y,f,w,I,v,S,A,P,C,E,k,t])},V=async(e,t,n,a,i,o,r,s,l,d,p,u,m,h,f,I,y,w,v,S,C,A,b,P,k)=>{const B=P.newScenario(T.Cu.FileViewerResolver);try{const V=(0,g.sI)(e.fileType),O=await Q(e,d,b),U=k.current;e={...e,tenantId:O?.channelByID.owningTeam?.tenantId||void 0};const L=await x(d,e.fileType,p,u,m,h,f,I,y,w,v,S,b,P);if(e.subEntityId){const t=l(c.ck.extensions,c.SY.view);s.pushToWindowHistory(r,{...t,subEntityId:e.subEntityId})}if(L){if(B.mark(T.BQ.FileViewerResolverRoutingToInstalledApp),a(t,{...n,dataBagProperties:{...n.dataBagProperties,fileViewerType:"PlatformApp",fileViewerAppId:L,fileAction:$.BK.editInTeams},actionKey:"edit_in_teams"}),U.get(e.fileId)!==e.threadId&&(0,E.RL)(P,L,"personalApp",b,e.shouldOpenInMultiWindow,!0),U.set(e.fileId,e?.threadId),e.threadId&&C&&"Desktop"===A){const n={convId:e.threadId,messageId:e.messageId,appId:L,entryPoint:D.hB.fileChiclet,contentUrl:e.shareUrl||e.objectUrl,websiteUrl:e.shareUrl||e.objectUrl,entityId:e.fileId,subEntityId:JSON.stringify({...e,hideClose:!0,fileTitle:t.title}),correlationId:(0,F.A)(),scenarioStartTime:(new Date).getTime()};return e.replyChainId&&(n.replyChainId=e.replyChainId),(0,M.N)(n,o,d,P,b,void 0,i).then((()=>B.stop())).catch((e=>{const t=`Unexpected error while launching stage: ${e?.errorCode}`;b.errorToTelemetry?.(t,"files_viewer_resolver"),B.mark("StageViewLaunchFailed")}))}return i.file.launchFileViewApp(L,{...e,baseUrl:e.siteUrl}),void B.stop()}V===g.j_.OneUpViewer?(B.mark(T.BQ.FileViewerResolverRoutingToOneupViewer),a(t,{...n,dataBagProperties:{...n.dataBagProperties,fileViewerType:"OneUp",fileAction:$.BK.openInTeams},actionKey:"edit_in_teams"}),i.file.openInOneup(e)):(b.errorToTelemetry?.("This means no platform app installed for a office file type. Not good","files_viewer_resolver"),B.mark(T.BQ.FileViewerResolverFallback),a(t,{...n,actionKey:"edit_in_teams"}),i.file.fileById(e)),B.stop()}catch(e){const t=`Unexpected error while file viewer resolution with error code: ${e?.errorCode}`;b.errorToTelemetry?.(t,"files_viewer_resolver"),B.fail({errorCode:e?.errorCode,message:t,reason:"Unexpected error while file viewer resolution"})}},x=async(e,t,n,a,i,o,r,s,l,c,d,p,g,m)=>{const h=await O(e,t,n,a,i,o,r,s,l,c,d,p,g,m);if(h){const t=await(0,u.tN)(e,g,m,h,d,"file-viewer-route-to-platform-app",{shouldFetchPersonalApps:!0,enableInstalledAppQueryOptimization:p});if(t&&t.length>0&&(g.logNoPii?.(`getDocumentViewAppId: Pre-install check enabled: app pre-install state ${t[0].installationState}`),L(t[0])))return h}},O=async(e,t,n,a,i,o,r,s,l,c,d,p,u,T)=>{const{icon:k}=(0,g.ao)(t);switch(k){case m.f:case h.K:if(n)return"3e0a4fec-499b-4138-8e7c-71a9d88a62ed";break;case f.E:case I.j:if(n)return"d7958adf-f419-46fa-941b-1b946497ef84";break;case y.V:case w.g:if(n)return"1c256a65-83a6-4b5c-9ccf-78f8afb6f1e8";break;case v.P:if(a)return U(o,s,i,r,e,d,p,u,T);break;case S.y:case C.T:case A.v:if(l)return"0d820ecd-def2-4297-adad-78056cde7c78";break;case b.a:case P.r:if(c)return"d7958adf-f419-46fa-941b-1b946497ef95"}},U=async(e,t,n,a,i,o,r,s,l)=>{const c=e;if(c){const e=await(0,u.tN)(i,s,l,c,o,"check-status-and-give-pdf-app-for-user",{shouldFetchPersonalApps:!0,enableInstalledAppQueryOptimization:r});if(n){if(!(e&&e.length>0))return;{const t=e[0].installerIdentity?.azureAdAppId,n=t&&a?.includes(t);if(s.logNoPii?.(`getDocumentViewAppId: AAA Pre-install check enabled: Is App Installed by AAA:  ${n} and installedByAppId: ${t}}`),n)return c}}return t?e&&e.length>0?(s.logNoPii?.(`getDocumentViewAppId: Pre-install check enabled: app pre-install state ${e[0].installationState}`),"AdminPreInstalled"===e[0].installationState?c:void 0):void 0:c}},L=e=>!!e.installationState&&["Installed","InstalledAndFavorited","InstalledAndPermanent","AdminPreInstalled"].includes(e.installationState),Q=async(e,t,n)=>{try{if(e.threadId){const{data:a,error:i}=await t.query({query:k.q,fetchPolicy:"cache-first",variables:{conversationId:e.threadId}});return i?void n.errorToTelemetry?.(`getChannelFields threw error ${i.message}`,"files_viewer_resolver"):a}return}catch(e){return void(e?.message?.includes("Id is not of a channel")?n.logNoPii?.(`Not called from channel ${e.message}`):n.errorToTelemetry?.(`Exception while fetching channel info ${e?.message}`,"files_viewer_resolver"))}},R=(e,t,n)=>t&&!n?{...e,shouldOpenInMultiWindow:!0}:e},147994:(e,t,n)=>{n.d(t,{bq:()=>a,Lx:()=>g,$o:()=>m,A_:()=>h,d1:()=>f,Gi:()=>I,pE:()=>y,iE:()=>w,mg:()=>v,lT:()=>C,QP:()=>b});var a,i=n(401368),o=n(315560),r=n(214568),s=n(282076),l=n(160035),c=n(94939),d=n(396588),p=n(725609),u=n(480354);!function(e){e.modal="modal",e.popout="popout",e.popoutWithChat="popoutWithChat"}(a||(a={}));const g=(e,t)=>e.entryPoint===p.hB.fileChiclet&&t?t:e.contentUrl,m=(e,t)=>t?`${e};replyChainId=${t}`:e,h=(e,t,n)=>{const{licenseType:a}=e.get(i.w.UserResources),{enableStageviewMW:o,enableStageviewMWInChannels:r,enableCollabStageForEDU:l}=e.get(i.w.Extensibility),c=t===p.hQ.desktop;return!(!l&&(0,s.Cd)(a)||!c)&&(!(!o&&!r)&&("chats"===n.type||"channels"===n.type||"callingchats"===n.type))},f=e=>{const t=d.Cu.PlatformTabStageViewFrameLoading,n=e.newScenario(t),a=e.newScenario(d.Cu.PlatformTabLaunch);return n.clientId=n.id,a.clientId=a.id,e.hoistScenarioToCore?.(n),e.hoistScenarioToCore?.(a),{phase1CollabStageScenario:n,endToEndScenario:a}},I=(e,t)=>`${e.appId}-${e.convId}-${t}-${e.reloadToggle}`;function y(e,t,n){const a={};try{if(n?.linkedEntity?.type===o.ck.calls){const{convId:t,messageId:i}=(0,c.q0)(n,o.ck.extensions,o.SY.view,e);i&&"0"!==i?(a.channelId=t,a.parentMessageId=i,a.channelMeetingMessageId=i,a.chatId=t):a.chatId=t}else if(n?.linkedEntity?.type===o.ck.channels){const{channelId:t}=n?.linkedEntity?.id&&JSON.parse(n?.linkedEntity?.id);a.channelId=t;const{messageId:i,replyChainId:r}=(0,c.q0)(n,o.ck.extensions,o.SY.view,e);a.replyChainId=r,a.parentMessageId=i,a.channelMeetingMessageId=i}else switch(n?.type){case o.ck.channels:const{channelId:i}=n?.id&&JSON.parse(n.id);a.channelId=i;break;case o.ck.chats:const r=(n.id??"").split(";replyChainId=");r.length>1&&(a.replyChainId=r[1],a.channelId=r[0]),a.chatId=r[0];break;case o.ck.extensions:const s=(0,l.Wo)(n,t,e);a.parentMessageId=s?.messageId,a.channelMeetingMessageId=s?.messageId,a.chatId=s?.messageId?void 0:s?.threadId,a.channelId=s?.messageId?s?.threadId:void 0}}catch(t){e.log("Error while parsing source view entity.",t?.message)}return a}const w=e=>{const{convId:t}=e;return{stageViewId:I(e,e.contentUrl),linkedEntity:{id:m(t,e.replyChainId),type:o.ck.chats}}},v=(e,t)=>{const{sdkHostType:n}=e.get(i.w.Sdk),o="Desktop"===n,{enableProgrammaticPopoutStageViewOpenAPI:r,enableProgrammaticPopoutStageDeeplink:s}=e.get(i.w.Extensibility);return t.entryPoint===p.hB.adaptiveCardCollabStage?a.popoutWithChat:t.entryPoint===p.hB.deepLinkStageView?S(t,o,!!s):S(t,o,!!r)},S=(e,t,n)=>{if(!t||!n)return a.modal;const i=e.openMode||a.popoutWithChat;return i===a.popoutWithChat?e.convId||e.channelId?e.channelId&&!e.replyChainId?a.popout:a.popoutWithChat:a.popout:i},C=(e,t)=>{switch(t){case p.hB.adaptiveCardCollabStage:return{actionOutcome:A(e),panelType:r.HP.AdaptiveCardCollabStage};case p.hB.stageViewOpenSDKApi:return{actionOutcome:A(e),panelType:r.HP.StageViewOpenSDKAPI};case p.hB.adaptiveCardStageModal:return{actionOutcome:A(e),panelType:r.HP.CollabStageViewModal};case p.hB.deepLinkStageView:return{actionOutcome:A(e),panelType:r.HP.DeeplinkStageView};default:return{actionOutcome:A(e),panelType:r.HP.AdaptiveCardCollabStage}}},A=e=>{switch(e){case a.modal:return r.nd.modal;case a.popout:return r.nd.popout;default:return r.nd.popoutWithChat}},b=e=>{const t=!(0,u.isEmpty)(e.tenantId),n=e.isMicrosoftOwned??!1;return(e.isFullScreenApp??!1)&&(t||n)}}}]);
//# sourceMappingURL=https://local.teams.office.com/sourcemaps/hashed-assets/731276-7d302be88b08e15d.js.map